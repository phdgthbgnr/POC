!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t=t.com||(t.com={}),t=t.massmotionmedia||(t.massmotionmedia={}),t.ad=e()}}(function(){return function e(t,n,i){function o(a,c){if(!n[a]){if(!t[a]){var r="function"==typeof require&&require;if(!c&&r)return r(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n?n:e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){function i(e){e.crea=this,this.ad=new o(e)}var o=e("./src/core/Ad");if(!window.console){var s={};s.log=function(){},s.error=function(){},window.console=s}t.exports=i},{"./src/core/Ad":5}],2:[function(e,t,n){function i(){this.events={}}var o=e("core"),s=e("es5-indexOf"),a=i.prototype;a.on=function(e,t){var n=this.events[e]||(this.events[e]=[]);return n.push(t),this},a.once=function(e,t){var n=this;return this.on(e,function(){t.apply(null,o.slice.call(arguments,0)),n.off(e,t)}),this},a.off=function(e,t){var n=this.events[e];if(n){var i=s(n,t);-1!==i&&(n.splice(i,1),0===n.length&&delete this.events[e])}return this},a.emit=function(e){var t=o.slice.call(arguments,0);t.splice(0,1);var n=this.events[e];if(n&&n.length){n=o.slice.call(n,0);for(var i=0,s=n.length;s>i;i++)n[i].apply(null,t)}},t.exports=i},{core:3,"es5-indexOf":4}],3:[function(e,t,n){(function(e){function n(e){var t=o.body||o.getElementsByTagName("head")[0];t?t.appendChild(e):setTimeout(function(){n(e)},1)}function i(e,t){var n=!1;return function(){e.readyState&&"complete"!==e.readyState&&"loaded"!==e.readyState||n||(n=!0,e.onload=e.onreadystatechange=null,t(null))}}var o=e.document,s=e.console;t.exports={global:e,load:function(e,t){var s=o.createElement("script");s.async=!0,s.type="text/javascript",s.src=e,s.onload=s.onreadystatechange=i(s,t),n(s)},now:function(){return Date.now?Date.now():+new Date},log:function(){s&&s.log&&s.log.apply(s,arguments)},warn:function(){s&&s.warn&&s.warn.apply(s,arguments)},error:function(){s&&s.error&&s.error.apply(s,arguments)},makeRandomString:function(e){for(var t="",n=0;e>n;n++)t+=Math.floor(16*Math.random()).toString("16");return t},slice:Array.prototype.slice,createObject:"function"==typeof Object.create?function(e,t){return Object.create(e,t)}:function(){var e=function(){};return function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");e.prototype=t;var n=new e;return e.prototype=null,n}}()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){function i(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;var s=+t||0;if(Math.abs(s)===1/0&&(s=0),s>=o)return-1;for(n=Math.max(s>=0?s:o-Math.abs(s),0);o>n;){if(n in i&&i[n]===e)return n;n++}return-1}t.exports="function"==typeof Array.prototype.indexOf?function(e,t,n){return e.indexOf?e.indexOf(t,n):i.call(e,t,n)}:function(e,t,n){return i.call(e,t,n)}},{}],5:[function(e,t,n){function i(e){this.version="1.0.9",console.log("[new Ad] ",this.version),this.event=new o,window.cc={},this.messaging=new a,this.browser=c,this.sizmek=new s(e),this.videoHandler,this.skipStartVideoRightAfterCollapse,this.resumeVideoOnMouseEnter,this.localStorage,this.status={isAtTheEnd:!1,currentCapping:-1,isCollapsed:!0},this.initAd=function(){if(this.localStorage=new r,this.status.currentCapping=this.localStorage.getData("hit"),console.log("   > initAd : currentCapping "+this.status.currentCapping),this.localStorage.incrementHit(),e.injectSvg&&(c.isOnline||c.isFirefox)){console.log("   > inject SVG... ");var t=document.querySelectorAll("img.inject-me");0===t.length?this.setupAd():SVGInjector(t,{},this.setupAd.bind(this))}else e.injectSvg&&console.log("   [warning] svg injection only work in Firefox local mode"),this.setupAd()},this.setupAd=function(){console.log("   > setupAd ");var t=document.querySelectorAll("[data-cc],svg.injected-svg"),n="",i="";for(var o in t)i=t[o].id,i&&(window.cc[i]=t[o],n+=i+", ");cc.ad||console.error('"ad" div must be flagged with a data-cc attributes !'),console.log("   > available creative content ( @see ad.cc ) : "+n),this.addEventListeners(),this.initMessaging(),this.videoHandler=new l([cc.video,cc.videoExpand],e,this.event,this.sizmek,this.messaging),e.collapseOnVideoEnd!==!1&&this.event.on("VIDEO_EXPAND_END",this.collapse.bind(this)),this.event.on("VIDEO_END",function(){this.status.isAtTheEnd=!0}.bind(this)),this.event.on("VIDEO_PLAY",function(){this.status.isAtTheEnd=!1}.bind(this)),console.log("   [event] Ad::START_AD "),this.event.emit("START_AD",this),this.getCurrentScenario().autoExpand===!0&&(this.localStorage.incrementAutoExpand(),this.expand())},this.getCurrentScenario=function(){if(e.scenarioCapping){var t=this.status.currentCapping,n=e.scenarioCapping[t]?t:e.scenarioCapping.length-1;return e.scenarioCapping[n]}return{}},this.replay=function(t){t&&t.stopPropagation(),cc.replay&&(cc.replay.style.display="none"),cc.expand&&(cc.expand.style.display="block"),console.log("   [event] Ad::REPLAY_AD "),this.event.emit("REPLAY_AD",this),e.expandOnReplay&&this.expand()},this.addEventListeners=function(){console.log("   > addEventListeners (ad, pause, play, sound, mute, replay, ...)"),cc.ad&&(cc.ad.addEventListener("click",this.clickthrough.bind(this),!1),cc.ad.addEventListener("mouseenter",this.onMouseEnterAd.bind(this),!1),cc.ad.addEventListener("mouseleave",this.onMouseLeaveAd.bind(this),!1));var e=this;cc.replay&&cc.replay.addEventListener("click",this.replay.bind(this)),cc.expand&&cc.expand.addEventListener("click",function(t){t.stopPropagation(),e.expand()}),cc.close&&cc.close.addEventListener("click",function(t){t.stopPropagation(),e.collapse()})},this.onMouseEnterAd=function(t){t.stopPropagation(),this.resumeVideoOnMouseEnter&&(this.resumeVideoOnMouseEnter.play(),this.resumeVideoOnMouseEnter=null),e.expandOnRollOver&&!this.status.isAtTheEnd&&this.expand(),console.log("   [event] Ad::MOUSE_ENTER_AD "),this.event.emit("MOUSE_ENTER_AD",this)},this.onMouseLeaveAd=function(t){t.stopPropagation(),console.log("   [event] Ad::MOUSE_LEAVE_AD "),this.getCurrentScenario().collapseOnRollOut!==!0||this.skipStartVideoRightAfterCollapse||(console.log("   > collapse on mouse leave"),this.collapse()),e.collapseOnRollOut&&this.collapse(),console.log("   [event] Ad::MOUSE_LEAVE_AD "),this.event.emit("MOUSE_LEAVE_AD",this)},this.initMessaging=function(){var e=this;this.messaging.addMessageListener("pauseVideo",function(){cc.video&&cc.video.pause(),cc.videoExpand&&cc.videoExpand.pause()}),this.messaging.addMessageListener("expandFormat",function(){e.expand()}),this.messaging.addMessageListener("rollout",function(){e.collapse()}),document.addEventListener("mousemove",function(t){e.messaging.dispatchMessage("moveEvent",{clientX:t.pageX||t.clientX,clientY:t.pageY||t.clientY})})},this.startVideo=function(e,t){return this.skipStartVideoRightAfterCollapse&&(new Date).getTime()-this.skipStartVideoRightAfterCollapse<1e3?(this.skipStartVideoRightAfterCollapse=null,this.resumeVideoOnMouseEnter=e,void console.log("   [SKIP] startVideo() after collapse ")):void this.videoHandler.startVideo(e,t)},this.preventExpand=function(){console.log("   [prevent] expand "),this.status.preventExpand=!0},this.expand=function(e,t){if(e!==!0&&this.event.emit("BEFORE_EXPAND_AD",this),this.status.isCollapsed){if(this.status.preventExpand)return this.status.preventExpand=!1,void console.log("   > expand cancel");console.log("   > expand"),d.removeClass(cc.ad,"collapseSize"),d.setClass(cc.ad,"expandSize"),this.sizmek.expand(t),this.status.isCollapsed=!1,this.messaging.dispatchMessage("expand"),console.log("   [event] Ad::EXPAND_AD "),this.event.emit("EXPAND_AD",this)}},this.preventCollapse=function(){console.log("   [prevent] collapse "),this.status.preventCollapse=!0},this.collapse=function(t,n){if(t!==!0&&this.event.emit("BEFORE_COLLAPSE_AD",this),!this.status.isCollapsed){if(this.status.preventCollapse)return this.status.preventCollapse=!1,void console.log("   > collapse cancel");console.log("   > collapse"),this.sizmek.collapse(n),cc.expand&&(cc.expand.display="block"),!e.pushdownSettings||!e.pushdownSettings.collapseDuration||e.pushdownSettings.collapseDuration<=0?this.collapseNow():setTimeout(this.collapseNow.bind(this),e.pushdownSettings.collapseDuration+100)}},this.collapseNow=function(){d.removeClass(cc.ad,"expandSize"),d.setClass(cc.ad,"collapseSize"),this.status.isCollapsed=!0,this.messaging.dispatchMessage("collapse"),console.log("   [event] Ad::COLLAPSE_AD "),this.event.emit("COLLAPSE_AD",this)},this.clickthrough=function(e){console.log("   > clickthrough (internal) "),e.stopPropagation(),cc.video&&cc.video.pause(),cc.videoExpand&&cc.videoExpand.pause(),this.event.emit("CLICK_AD",e),this.skipStartVideoRightAfterCollapse=(new Date).getTime(),this.collapse()},this.sizmek.config=e,this.sizmek.event.on("INIT_AD",this.initAd.bind(this)),this.sizmek.event.on("EXPAND_AD",this.expand.bind(this)),this.sizmek.event.on("COLLAPSE_AD",this.collapse.bind(this))}var o=e("event-emitter"),s=e("./Sizmek"),a=e("../util/Messaging"),c=e("../util/Browser"),r=e("../util/LocalStorage"),l=e("../util/VideoHandler"),d=e("../util/Tools");t.exports=i},{"../util/Browser":7,"../util/LocalStorage":8,"../util/Messaging":9,"../util/Tools":10,"../util/VideoHandler":12,"./Sizmek":6,"event-emitter":2}],6:[function(e,t,n){function i(e){console.log("[new Sizmek]"),e&&window.addEventListener("load",this.initEB.bind(this)),this.event=new o,this.config}var o=e("event-emitter");i.prototype.initEB=function(){EB.isInitialized()?this.startAd():EB.addEventListener(EBG.EventName.EB_INITIALIZED,this.startAd.bind(this))},i.prototype.startAd=function(){console.log("   >szk> startAd "),this.config&&this.config.pushdownSettings&&EB._sendMessage("resizecontainer",this.config.pushdownSettings),console.log("   [event] Sizmek::INIT_AD "),this.event.emit("INIT_AD",this)},i.prototype.getCustomJSVar=function(e,t){"undefined"==typeof t&&(t=null);try{return"undefined"!=typeof EB._adConfig.customJSVars&&EB._adConfig.customJSVars.hasOwnProperty(e)?"undefined"==typeof EB._adConfig.customJSVars[e]?t:"string"==typeof EB._adConfig.customJSVars[e]?EB._adConfig.customJSVars[e].toString().replace(/&quot;/g,'"'):EB._adConfig.customJSVars[e]:t}catch(n){return t}},i.prototype.expand=function(e){EB.expand(e)},i.prototype.collapse=function(e){EB.collapse(e)},i.prototype.initVideo=function(e){console.log("   >szk> initVideo : #"+e.id),new EBG.VideoModule(e)},i.prototype.checkSameUid=function(e){return EB._isLocalMode?!0:e===EB._adConfig.uid},t.exports=i},{"event-emitter":2}],7:[function(e,t,n){function i(){this.isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent),this.isOnline="http:"===window.location.protocol||"https:"===window.location.protocol,this.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,this.isFirefox="undefined"!=typeof InstallTrigger,this.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,this.isChrome=!!window.chrome&&!this.isOpera,this.isIE=!!document.documentMode,this.isIE9=/msie 9/i.test(navigator.userAgent),this.isMobile=/iPhone|Android.*Mobile/i.test(navigator.userAgent),this.isTablet=/iPad|Android(?!.*Mobile)/i.test(navigator.userAgent)}t.exports=new i},{}],8:[function(e,t,n){function i(){this.expandLimit=1,this.getNamespace=function(){var e="local";return EB._adConfig&&EB._adConfig.adId&&(e=EB._adConfig.adId),"com.massmotionmedia."+e},this.namespace=this.getNamespace(),this.getData=function(e){var t,n,i,o=new Date;try{return t=localStorage.getItem(this.namespace+"."+e+"TS"),t=t?Number(t):0,n=new Date(t),o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&(i=localStorage.getItem(this.namespace+"."+e)),i?Number(i):0}catch(s){return console.log(s),0}},this.setData=function(e,t){try{localStorage.setItem(this.namespace+"."+e,t),localStorage.setItem(this.namespace+"."+e+"TS",+new Date)}catch(n){}},this.incrementAutoExpand=function(){var e=this.getData("autoExpand");this.setData("autoExpand",++e)},this.incrementHit=function(){var e=this.getData("hit");this.setData("hit",++e)},this.shouldExpand=function(){var e=this.getData("autoExpand");return e<this.expandLimit}}t.exports=i},{}],9:[function(e,t,n){function i(){this.listenerList={},this.init()}i.prototype.init=function(){console.log("[Messaging] init");var e=this;window.addEventListener("message",function(t){try{var n=JSON.parse(t.data);e.messageReceived(n)}catch(i){console.error("message ignoré : ",t)}})},i.prototype.dispatchMessage=function(e,t){t||(t={}),!t.uid&&EB._adConfig&&(t.uid=EB._adConfig.uid),"moveEvent"!==e&&console.log("  [dispatch msg] ",e,t),EB._sendMessage(e,t)},i.prototype.messageReceived=function(e){if("moveEvent"!==e.type&&console.log("  [receive msg] ",e.type,e.data),"PUSHDOWN_TRANSITION_END"===e.type&&console.log("[PUSHDOWN_TRANSITION_END] received !"),e.data&&(EB._isLocalMode||e.data.uid===EB._adConfig.uid)){var t=this.listenerList[e.type];if(t)for(var n=0;n<t.length;n++)t[n](e.data)}},i.prototype.addMessageListener=function(e,t){this.listenerList[e]||(this.listenerList[e]=[]),this.listenerList[e].push(t)},t.exports=i},{}],10:[function(e,t,n){function i(){this.setClass=function(e,t){var n=null;"undefined"==typeof e.className?(n=e.getAttribute("class"),n.indexOf(t)<0&&(t.length>0&&(t=n+" "+t),e.setAttribute("class",t))):(n=e.className,n.indexOf(t)<0&&(t.length>0&&(t=n+" "+t),e.className=t))},this.removeClass=function(e,t){var n=null,i=new RegExp("(\\s|^)+"+t.replace("-","\\-")+"(\\s|$)+");"undefined"==typeof e.className?(n=e.getAttribute("class").replace(i," "),e.setAttribute("class",n)):e.className=e.className.replace(i," ")}}t.exports=new i},{}],11:[function(e,t,n){function i(e,t,n,o,c,r){var l=s();r||(r=l),l=(l-r)/c,a(function(){var s=o.map(function(e){return n?n(e,l):l*e});e(s),1>l?i(e,t,n,o,c,r):(e(o),t&&t())})}function o(e,t,n){if("undefined"!=typeof Array){t=1e3*t,e instanceof Array||(e=[e]);var o=Object.keys(n),s=o.map(function(e){return n[e]});i(function(t){var n;o.forEach(function(i,o){n="top"===i||"left"===i||"width"===i||"height"===i?"px":"",e.map(function(e){e&&(e.style[i]=t[o]+n)})})},n.onComplete,null,s,t)}}var s,a=window.requestAnimationFrame||function(e){setTimeout(e,16)};s=window.performance&&"function"==typeof window.performance.now?window.performance.now.bind(window.performance):function(){return+new Date},t.exports={to:o,animate:i}},{}],12:[function(e,t,n){function i(e,t,n,i,a){this.videoPlayAsked,this.config=t,this.event=n,this.messaging=a,this.canplayFired=!1,this.initVideo=function(e,t){console.log(" [init video] : ",e,t);var n=t.play,i=t.pause,s=t.sound,a=t.mute;e.preload="auto";var c=this;n&&i&&(e.addEventListener("playing",function(){"video"===e.id?(c.messaging.dispatchMessage("startVideo"),c.event.emit("VIDEO_PLAY",this)):(c.messaging.dispatchMessage("startVideoExpand"),c.event.emit("VIDEO_EXPAND_PLAY",this)),n.style.display="none",i.style.opacity=0,i.style.display="block",o.to(i,.3,{opacity:1})}),e.addEventListener("pause",function(){i.style.display="none",n.style.opacity=0,n.style.display="block",o.to(n,.3,{opacity:1})})),s&&a&&e.addEventListener("volumechange",function(){0===e.volume?(s.style.display="none",a.style.opacity=0,a.style.display="block",o.to(a,.3,{opacity:1})):(a.style.display="none",s.style.opacity=0,s.style.display="block",o.to(s,.3,{opacity:1}))}),e.addEventListener("ended",this.onVideoEnd.bind(this)),e.addEventListener("canplay",function(){c.videoPlayAsked?(console.log("canplay > videoPlayAsked > "+c.videoPlayAsked.id),c.canplayFired=!0,c.startVideo(c.videoPlayAsked)):console.log("canplay fired")}),i&&i.addEventListener("click",function(t){t.stopPropagation(),e.pause()}),n&&n.addEventListener("click",function(t){t.stopPropagation(),e.play()}),s&&s.addEventListener("click",function(t){t.stopPropagation(),e.volume=0}),a&&a.addEventListener("click",function(t){t.stopPropagation(),e.volume=1})},this.onVideoEnd=function(e){"video"===e.target.id?(cc.replay&&(cc.replay.style.display="block"),cc.expand&&(cc.expand.style.display="none"),o.to(cc.videoWrapper,.25,{opacity:0,onComplete:function(){cc.videoWrapper.style.display="none"}}),this.messaging.dispatchMessage("endVideo"),console.log("   [event] Ad::VIDEO_END "),this.event.emit("VIDEO_END",this)):(o.to(cc.videoExpandWrapper,.25,{opacity:0}),this.messaging.dispatchMessage("endVideoExpand"),console.log("   [event] Ad::VIDEO_EXPAND_END "),this.event.emit("VIDEO_EXPAND_END",this))},this.startVideo=function(e,t){if(e){console.log("   > startVideo, video.readyState : ",e.readyState," isIE9 : ",s.isIE9);var n="video"===e.id?cc.videoWrapper:cc.videoExpandWrapper;n&&(n.style.display="block",n.style.opacity=0),0===t||0===this.config.videoAlpha?n&&(n.style.opacity=1):o.to(n,t||this.config.videoAlpha||0,{opacity:1}),e.controls=!1,4===e.readyState||2===e.readyState||3===e.readyState||this.canplayFired?(this.canplayFired=!0,this.videoPlayAsked=!1,e.currentTime=0,e.play(),e.volume=.1,"videoExpand"===e.id&&this.config.defaultSoundOnExpand?e.volume=this.config.defaultSoundOnExpand:e.volume=0):(1===e.readyState&&(e.controls=!0),console.log("   > startVideo > videoPlayAsked (standby)"),this.videoPlayAsked=e)}else console.log("[warning] ad.startVideo : video argument is undefined")},this.onExpand=function(){this.config.defaultSoundOnExpand&&cc.videoExpand&&(cc.videoExpand.volume=this.config.defaultSoundOnExpand),cc.video&&!this.config.preventVideoPauseOnExpand&&cc.video.pause(),cc.videoExpand&&s.isIOS&&cc.videoExpand.play()},this.onCollapse=function(){cc.videoExpand&&cc.videoExpand.pause()};for(var c,r=0;r<e.length;r++)if(c=e[r]){var l,d=c.parentNode.childNodes,p={play:null,pause:null,sound:null,mute:null};for(var u in d)if(l=d[u].id,l&&l!==c.id)for(var h in p)if(l.match(new RegExp(h))){p[h]=d[u];break}i.initVideo(c),this.initVideo(c,p)}this.event.on("EXPAND_AD",this.onExpand.bind(this)),this.event.on("COLLAPSE_AD",this.onCollapse.bind(this))}var o=e("../util/TweenPico"),s=e("../util/Browser");t.exports=i},{"../util/Browser":7,"../util/TweenPico":11}]},{},[1])(1)});
//# sourceMappingURL=ad.min.js.map
