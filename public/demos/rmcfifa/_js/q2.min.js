/*!
 *
 * Copyright 2009-2016 Kris Kowal under the terms of the MIT
 * license found at https://github.com/kriskowal/q/blob/v1/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(a){if(typeof bootstrap==="function"){bootstrap("promise",a)}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define(a)}else{if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=a}}else{if(typeof window!=="undefined"||typeof self!=="undefined"){var c=typeof window!=="undefined"?window:self;var b=c.Q;c.Q=a();c.Q.noConflict=function(){c.Q=b;return this}}else{throw new Error("This environment was not anticipated by Q. Please file a bug.")}}}}}})(function(){var F=false;try{throw new Error()}catch(ak){F=!!ak.stack}var v=Y();var j;var ag=function(){};var al=(function(){var av={task:void 0,next:null};var at=av;var Q=false;var ap=void 0;var e=false;var aq=[];function aw(){var ay,az;while(av.next){av=av.next;ay=av.task;av.task=void 0;az=av.domain;if(az){av.domain=void 0;az.enter()}ax(ay,az)}while(aq.length){ay=aq.pop();ax(ay)}Q=false}function ax(ay,az){try{ay()}catch(aA){if(e){if(az){az.exit()}setTimeout(aw,0);if(az){az.enter()}throw aA}else{setTimeout(function(){throw aA},0)}}if(az){az.exit()}}al=function(ay){at=at.next={task:ay,domain:e&&process.domain,next:null};if(!Q){Q=true;ap()}};if(typeof process==="object"&&process.toString()==="[object process]"&&process.nextTick){e=true;ap=function(){process.nextTick(aw)}}else{if(typeof setImmediate==="function"){if(typeof window!=="undefined"){ap=setImmediate.bind(window,aw)}else{ap=function(){setImmediate(aw)}}}else{if(typeof MessageChannel!=="undefined"){var ar=new MessageChannel();ar.port1.onmessage=function(){ap=au;ar.port1.onmessage=aw;aw()};var au=function(){ar.port2.postMessage(0)};ap=function(){setTimeout(aw,0);au()}}else{ap=function(){setTimeout(aw,0)}}}}al.runAfter=function(ay){aq.push(ay);if(!Q){Q=true;ap()}};return al})();var a=Function.call;function q(e){return function(){return a.apply(e,arguments)}}var ad=q(Array.prototype.slice);var c=q(Array.prototype.reduce||function(aq,ap){var e=0,Q=this.length;if(arguments.length===1){do{if(e in this){ap=this[e++];break}if(++e>=Q){throw new TypeError()}}while(1)}for(;e<Q;e++){if(e in this){ap=aq(ap,this[e],e)}}return ap});var T=q(Array.prototype.indexOf||function(Q){for(var e=0;e<this.length;e++){if(this[e]===Q){return e}}return -1});var b=q(Array.prototype.map||function(aq,Q){var e=this;var ap=[];c(e,function(au,at,ar){ap.push(aq.call(Q,at,ar,e))},void 0);return ap});var I=Object.create||function(Q){function e(){}e.prototype=Q;return new e()};var am=Object.defineProperty||function(Q,ap,e){Q[ap]=e.value;return Q};var B=q(Object.prototype.hasOwnProperty);var H=Object.keys||function(e){var ap=[];for(var Q in e){if(B(e,Q)){ap.push(Q)}}return ap};var ao=q(Object.prototype.toString);function X(e){return e===Object(e)}function x(e){return(ao(e)==="[object StopIteration]"||e instanceof J)}var J;if(typeof ReturnValue!=="undefined"){J=ReturnValue}else{J=function(e){this.value=e}}var aa="From previous event:";function m(Q,at){if(F&&at.stack&&typeof Q==="object"&&Q!==null&&Q.stack){var aq=[];for(var ar=at;!!ar;ar=ar.source){if(ar.stack&&(!Q.__minimumStackCounter__||Q.__minimumStackCounter__>ar.stackCounter)){am(Q,"__minimumStackCounter__",{value:ar.stackCounter,configurable:true});aq.unshift(ar.stack)}}aq.unshift(Q.stack);var ap=aq.join("\n"+aa+"\n");var e=M(ap);am(Q,"stack",{value:e,configurable:true})}}function M(aq){var Q=aq.split("\n");var ar=[];for(var ap=0;ap<Q.length;++ap){var e=Q[ap];if(!g(e)&&!ab(e)&&e){ar.push(e)}}return ar.join("\n")}function ab(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function ai(e){var aq=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(aq){return[aq[1],Number(aq[2])]}var ap=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(ap){return[ap[1],Number(ap[2])]}var Q=/.*@(.+):(\d+)$/.exec(e);if(Q){return[Q[1],Number(Q[2])]}}function g(Q){var ap=ai(Q);if(!ap){return false}var aq=ap[0];var e=ap[1];return aq===j&&e>=v&&e<=t}function Y(){if(!F){return}try{throw new Error()}catch(ar){var Q=ar.stack.split("\n");var ap=Q[0].indexOf("@")>0?Q[1]:Q[2];var aq=ai(ap);if(!aq){return}j=aq[0];return aq[1]}}function D(ap,e,Q){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(e+" is deprecated, use "+Q+" instead.",new Error("").stack)}return ap.apply(ap,arguments)}}function l(e){if(e instanceof P){return e}if(O(e)){return N(e)}else{return A(e)}}l.resolve=l;l.nextTick=al;l.longStackSupport=false;var n=1;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){l.longStackSupport=true}l.defer=h;function h(){var aq=[],at=[],ar;var Q=I(h.prototype);var av=I(P.prototype);av.promiseDispatch=function(ax,ay,aw){var e=ad(arguments);if(aq){aq.push(e);if(ay==="when"&&aw[1]){at.push(aw[1])}}else{l.nextTick(function(){ar.promiseDispatch.apply(ar,e)})}};av.valueOf=function(){if(aq){return av}var e=K(ar);if(z(e)){ar=e}return e};av.inspect=function(){if(!ar){return{state:"pending"}}return ar.inspect()};if(l.longStackSupport&&F){try{throw new Error()}catch(au){av.stack=au.stack.substring(au.stack.indexOf("\n")+1);av.stackCounter=n++}}function ap(e){ar=e;if(l.longStackSupport&&F){av.source=e}c(aq,function(ax,aw){l.nextTick(function(){e.promiseDispatch.apply(e,aw)})},void 0);aq=void 0;at=void 0}Q.promise=av;Q.resolve=function(e){if(ar){return}ap(l(e))};Q.fulfill=function(e){if(ar){return}ap(A(e))};Q.reject=function(e){if(ar){return}ap(E(e))};Q.notify=function(e){if(ar){return}c(at,function(ax,aw){l.nextTick(function(){aw(e)})},void 0)};return Q}h.prototype.makeNodeResolver=function(){var e=this;return function(Q,ap){if(Q){e.reject(Q)}else{if(arguments.length>2){e.resolve(ad(arguments,1))}else{e.resolve(ap)}}}};l.Promise=V;l.promise=V;function V(ap){if(typeof ap!=="function"){throw new TypeError("resolver must be a function.")}var e=h();try{ap(e.resolve,e.reject,e.notify)}catch(Q){e.reject(Q)}return e.promise}V.race=o;V.all=y;V.reject=E;V.resolve=l;l.passByCopy=function(e){return e};P.prototype.passByCopy=function(){return this};l.join=function(e,Q){return l(e).join(Q)};P.prototype.join=function(e){return l([this,e]).spread(function(Q,ap){if(Q===ap){return Q}else{throw new Error("Q can't join: not the same: "+Q+" "+ap)}})};l.race=o;function o(e){return V(function(ar,aq){for(var ap=0,Q=e.length;ap<Q;ap++){l(e[ap]).then(ar,aq)}})}P.prototype.race=function(){return this.then(l.race)};l.makePromise=P;function P(Q,ar,aq){if(ar===void 0){ar=function(at){return E(new Error("Promise does not support operation: "+at))}}if(aq===void 0){aq=function(){return{state:"unknown"}}}var ap=I(P.prototype);ap.promiseDispatch=function(aw,ax,au){var at;try{if(Q[ax]){at=Q[ax].apply(ap,au)}else{at=ar.call(ap,ax,au)}}catch(av){at=E(av)}if(aw){aw(at)}};ap.inspect=aq;if(aq){var e=aq();if(e.state==="rejected"){ap.exception=e.reason}ap.valueOf=function(){var at=aq();if(at.state==="pending"||at.state==="rejected"){return ap}return at.value}}return ap}P.prototype.toString=function(){return"[object Promise]"};P.prototype.then=function(ar,at,Q){var au=this;var av=h();var ap=false;function aq(ay){try{return typeof ar==="function"?ar(ay):ay}catch(ax){return E(ax)}}function aw(ax){if(typeof at==="function"){m(ax,au);try{return at(ax)}catch(ay){return E(ay)}}return E(ax)}function e(ax){return typeof Q==="function"?Q(ax):ax}l.nextTick(function(){au.promiseDispatch(function(ax){if(ap){return}ap=true;av.resolve(aq(ax))},"when",[function(ax){if(ap){return}ap=true;av.resolve(aw(ax))}])});au.promiseDispatch(void 0,"when",[void 0,function(ax){var az;var aA=false;try{az=e(ax)}catch(ay){aA=true;if(l.onerror){l.onerror(ay)}else{throw ay}}if(!aA){av.notify(az)}}]);return av.promise};l.tap=function(e,Q){return l(e).tap(Q)};P.prototype.tap=function(e){e=l(e);return this.then(function(Q){return e.fcall(Q).thenResolve(Q)})};l.when=R;function R(ap,e,Q,aq){return l(ap).then(e,Q,aq)}P.prototype.thenResolve=function(e){return this.then(function(){return e})};l.thenResolve=function(Q,e){return l(Q).thenResolve(e)};P.prototype.thenReject=function(e){return this.then(function(){throw e})};l.thenReject=function(Q,e){return l(Q).thenReject(e)};l.nearer=K;function K(Q){if(z(Q)){var e=Q.inspect();if(e.state==="fulfilled"){return e.value}}return Q}l.isPromise=z;function z(e){return e instanceof P}l.isPromiseAlike=O;function O(e){return X(e)&&typeof e.then==="function"}l.isPending=ae;function ae(e){return z(e)&&e.inspect().state==="pending"}P.prototype.isPending=function(){return this.inspect().state==="pending"};l.isFulfilled=S;function S(e){return !z(e)||e.inspect().state==="fulfilled"}P.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};l.isRejected=W;function W(e){return z(e)&&e.inspect().state==="rejected"}P.prototype.isRejected=function(){return this.inspect().state==="rejected"};var ac=[];var an=[];var af=[];var p=true;function aj(){ac.length=0;an.length=0;if(!p){p=true}}function C(Q,e){if(!p){return}if(typeof process==="object"&&typeof process.emit==="function"){l.nextTick.runAfter(function(){if(T(an,Q)!==-1){process.emit("unhandledRejection",e,Q);af.push(Q)}})}an.push(Q);if(e&&typeof e.stack!=="undefined"){ac.push(e.stack)}else{ac.push("(no stack) "+e)}}function k(Q){if(!p){return}var e=T(an,Q);if(e!==-1){if(typeof process==="object"&&typeof process.emit==="function"){l.nextTick.runAfter(function(){var ap=T(af,Q);if(ap!==-1){process.emit("rejectionHandled",ac[e],Q);af.splice(ap,1)}})}an.splice(e,1);ac.splice(e,1)}}l.resetUnhandledRejections=aj;l.getUnhandledReasons=function(){return ac.slice()};l.stopUnhandledRejectionTracking=function(){aj();p=false};aj();l.reject=E;function E(Q){var e=P({when:function(ar){if(ar){k(this)}return ar?ar(Q):this}},function aq(){return this},function ap(){return{state:"rejected",reason:Q}});C(e,Q);return e}l.fulfill=A;function A(e){return P({when:function(){return e},get:function(ap){return e[ap]},set:function(ap,aq){e[ap]=aq},"delete":function(ap){delete e[ap]},post:function(aq,ap){if(aq===null||aq===void 0){return e.apply(void 0,ap)}else{return e[aq].apply(e,ap)}},apply:function(aq,ap){return e.apply(aq,ap)},keys:function(){return H(e)}},void 0,function Q(){return{state:"fulfilled",value:e}})}function N(Q){var e=h();l.nextTick(function(){try{Q.then(e.resolve,e.reject,e.notify)}catch(ap){e.reject(ap)}});return e.promise}l.master=w;function w(e){return P({isDef:function(){}},function Q(aq,ap){return Z(e,aq,ap)},function(){return l(e).inspect()})}l.spread=f;function f(ap,e,Q){return l(ap).spread(e,Q)}P.prototype.spread=function(e,Q){return this.all().then(function(ap){return e.apply(void 0,ap)},Q)};l.async=U;function U(e){return function(){function ap(aw,au){var at;if(typeof StopIteration==="undefined"){try{at=aq[aw](au)}catch(av){return E(av)}if(at.done){return l(at.value)}else{return R(at.value,ar,Q)}}else{try{at=aq[aw](au)}catch(av){if(x(av)){return l(av.value)}else{return E(av)}}return R(at,ar,Q)}}var aq=e.apply(this,arguments);var ar=ap.bind(ap,"next");var Q=ap.bind(ap,"throw");return ar()}}l.spawn=s;function s(e){l.done(l.async(e)())}l["return"]=i;function i(e){throw new J(e)}l.promised=r;function r(e){return function(){return f([this,y(arguments)],function(Q,ap){return e.apply(Q,ap)})}}l.dispatch=Z;function Z(Q,ap,e){return l(Q).dispatch(ap,e)}P.prototype.dispatch=function(aq,ap){var Q=this;var e=h();l.nextTick(function(){Q.promiseDispatch(e.resolve,aq,ap)});return e.promise};l.get=function(e,Q){return l(e).dispatch("get",[Q])};P.prototype.get=function(e){return this.dispatch("get",[e])};l.set=function(e,Q,ap){return l(e).dispatch("set",[Q,ap])};P.prototype.set=function(e,Q){return this.dispatch("set",[e,Q])};l.del=l["delete"]=function(e,Q){return l(e).dispatch("delete",[Q])};P.prototype.del=P.prototype["delete"]=function(e){return this.dispatch("delete",[e])};l.mapply=l.post=function(ap,Q,e){return l(ap).dispatch("post",[Q,e])};P.prototype.mapply=P.prototype.post=function(Q,e){return this.dispatch("post",[Q,e])};l.send=l.mcall=l.invoke=function(Q,e){return l(Q).dispatch("post",[e,ad(arguments,2)])};P.prototype.send=P.prototype.mcall=P.prototype.invoke=function(e){return this.dispatch("post",[e,ad(arguments,1)])};l.fapply=function(Q,e){return l(Q).dispatch("apply",[void 0,e])};P.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};l["try"]=l.fcall=function(e){return l(e).dispatch("apply",[void 0,ad(arguments,1)])};P.prototype.fcall=function(){return this.dispatch("apply",[void 0,ad(arguments)])};l.fbind=function(Q){var aq=l(Q);var e=ad(arguments,1);return function ap(){return aq.dispatch("apply",[this,e.concat(ad(arguments))])}};P.prototype.fbind=function(){var ap=this;var e=ad(arguments);return function Q(){return ap.dispatch("apply",[this,e.concat(ad(arguments))])}};l.keys=function(e){return l(e).dispatch("keys",[])};P.prototype.keys=function(){return this.dispatch("keys",[])};l.all=y;function y(e){return R(e,function(aq){var Q=0;var ap=h();c(aq,function(av,au,at){var ar;if(z(au)&&(ar=au.inspect()).state==="fulfilled"){aq[at]=ar.value}else{++Q;R(au,function(aw){aq[at]=aw;if(--Q===0){ap.resolve(aq)}},ap.reject,function(aw){ap.notify({index:at,value:aw})})}},void 0);if(Q===0){ap.resolve(aq)}return ap.promise})}P.prototype.all=function(){return y(this)};l.any=L;function L(ap){if(ap.length===0){return l.resolve()}var Q=l.defer();var e=0;c(ap,function(at,av,ar){var ax=ap[ar];e++;R(ax,aw,aq,au);function aw(ay){Q.resolve(ay)}function aq(ay){e--;if(e===0){ay.message=("Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+ay.message);Q.reject(ay)}}function au(ay){Q.notify({index:ar,value:ay})}},undefined);return Q.promise}P.prototype.any=function(){return L(this)};l.allResolved=D(d,"allResolved","allSettled");function d(e){return R(e,function(Q){Q=b(Q,l);return R(y(b(Q,function(ap){return R(ap,ag,ag)})),function(){return Q})})}P.prototype.allResolved=function(){return d(this)};l.allSettled=u;function u(e){return l(e).allSettled()}P.prototype.allSettled=function(){return this.then(function(e){return y(b(e,function(ap){ap=l(ap);function Q(){return ap.inspect()}return ap.then(Q,Q)}))})};l.fail=l["catch"]=function(e,Q){return l(e).then(void 0,Q)};P.prototype.fail=P.prototype["catch"]=function(e){return this.then(void 0,e)};l.progress=G;function G(e,Q){return l(e).then(void 0,void 0,Q)}P.prototype.progress=function(e){return this.then(void 0,void 0,e)};l.fin=l["finally"]=function(e,Q){return l(e)["finally"](Q)};P.prototype.fin=P.prototype["finally"]=function(e){if(!e||typeof e.apply!=="function"){throw new Error("Q can't apply finally callback")}e=l(e);return this.then(function(Q){return e.fcall().then(function(){return Q})},function(Q){return e.fcall().then(function(){throw Q})})};l.done=function(ap,e,aq,Q){return l(ap).done(e,aq,Q)};P.prototype.done=function(e,aq,ap){var Q=function(at){l.nextTick(function(){m(at,ar);if(l.onerror){l.onerror(at)}else{throw at}})};var ar=e||aq||ap?this.then(e,aq,ap):this;if(typeof process==="object"&&process&&process.domain){Q=process.domain.bind(Q)}ar.then(void 0,Q)};l.timeout=function(ap,Q,e){return l(ap).timeout(Q,e)};P.prototype.timeout=function(ap,Q){var e=h();var aq=setTimeout(function(){if(!Q||"string"===typeof Q){Q=new Error(Q||"Timed out after "+ap+" ms");Q.code="ETIMEDOUT"}e.reject(Q)},ap);this.then(function(ar){clearTimeout(aq);e.resolve(ar)},function(ar){clearTimeout(aq);e.reject(ar)},e.notify);return e.promise};l.delay=function(e,Q){if(Q===void 0){Q=e;e=void 0}return l(e).delay(Q)};P.prototype.delay=function(e){return this.then(function(ap){var Q=h();setTimeout(function(){Q.resolve(ap)},e);return Q.promise})};l.nfapply=function(Q,e){return l(Q).nfapply(e)};P.prototype.nfapply=function(Q){var e=h();var ap=ad(Q);ap.push(e.makeNodeResolver());this.fapply(ap).fail(e.reject);return e.promise};l.nfcall=function(Q){var e=ad(arguments,1);return l(Q).nfapply(e)};P.prototype.nfcall=function(){var Q=ad(arguments);var e=h();Q.push(e.makeNodeResolver());this.fapply(Q).fail(e.reject);return e.promise};l.nfbind=l.denodeify=function(Q){if(Q===undefined){throw new Error("Q can't wrap an undefined function")}var e=ad(arguments,1);return function(){var aq=e.concat(ad(arguments));var ap=h();aq.push(ap.makeNodeResolver());l(Q).fapply(aq).fail(ap.reject);return ap.promise}};P.prototype.nfbind=P.prototype.denodeify=function(){var e=ad(arguments);e.unshift(this);return l.denodeify.apply(void 0,e)};l.nbind=function(ap,e){var Q=ad(arguments,2);return function(){var at=Q.concat(ad(arguments));var aq=h();at.push(aq.makeNodeResolver());function ar(){return ap.apply(e,arguments)}l(ar).fapply(at).fail(aq.reject);return aq.promise}};P.prototype.nbind=function(){var e=ad(arguments,0);e.unshift(this);return l.nbind.apply(void 0,e)};l.nmapply=l.npost=function(ap,Q,e){return l(ap).npost(Q,e)};P.prototype.nmapply=P.prototype.npost=function(ap,Q){var aq=ad(Q||[]);var e=h();aq.push(e.makeNodeResolver());this.dispatch("post",[ap,aq]).fail(e.reject);return e.promise};l.nsend=l.nmcall=l.ninvoke=function(ap,Q){var aq=ad(arguments,2);var e=h();aq.push(e.makeNodeResolver());l(ap).dispatch("post",[Q,aq]).fail(e.reject);return e.promise};P.prototype.nsend=P.prototype.nmcall=P.prototype.ninvoke=function(Q){var ap=ad(arguments,1);var e=h();ap.push(e.makeNodeResolver());this.dispatch("post",[Q,ap]).fail(e.reject);return e.promise};l.nodeify=ah;function ah(Q,e){return l(Q).nodeify(e)}P.prototype.nodeify=function(e){if(e){this.then(function(Q){l.nextTick(function(){e(null,Q)})},function(Q){l.nextTick(function(){e(Q)})})}else{return this}};l.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var t=Y();return l});